\documentclass{article}
\usepackage{graphicx} % Required for inserting images

\usepackage[a4paper, total={7in, 10.5in}]{geometry}
\usepackage{hyperref}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}

\newtheorem{theorem}{Theorem}%[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}


\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{assumption}[theorem]{Assumption}


\AtBeginEnvironment{definition}{\renewcommand\em{\bfseries\textit}}
\renewcommand\em{\bfseries}

\newcommand{\agap}{\hspace{0.25em}}
\newcommand{\dpair}[2]{\left\langle #1, #2 \right\rangle}
\newcommand{\subterm}{\sqsubset}
\newcommand{\subtermeq}{\sqsubseteq}
\newcommand{\supterm}{\sqsupset}
\newcommand{\suptermeq}{\sqsupseteq}


\usepackage[backend=biber]{biblatex}
\addbibresource{./ref.bib}

\title{The Relative Chain Framework for Modular Termination}
\author{\href{mailto:oi24939@bristol.ac.uk}{\texttt{Tom.Divers@bristol.ac.uk}}, \href{mailto:eddie.jones@bristol.ac.uk}{\texttt{Eddie.Jones@bristol.ac.uk}}}
\date{}
 
\begin{document}

\maketitle

\section{Introduction}

We present a new framework of \emph{relative chains} for proving the termination of the union of two terminating rewrite systems. We demonstrate how our framework can be used to prove the termination of functional programs augmented with equational hypotheses, and \emph{...}

\section{Preliminaries}

In this section, we discuss some mathematical preliminaries concerning term rewriting and reduction relations. The foundations of this field are explored in depth in \cite{baader1998terms}.

\subsection{Term Rewrite Systems}

We consider the setting of term rewriting systems over a \emph{signature} $T(\Sigma, V)$. A signature consists of a finite set of \emph{function symbols} $\Sigma$ and an infinite set of \emph{variables} $V$. $\Sigma$ is presumed to be partitioned into a set of \emph{defined functions} $\Sigma_{def}$ and \emph{constructors} $\Sigma_{con}$. Each $f \in \Sigma$ has an associated natural number called its \emph{arity}, and $\Sigma^{(i)}$ denotes all the function symbols in $\Sigma$ with arity $i$.

$T(\Sigma, V)$ is defined inductively as follows: \begin{enumerate}
    \item $\Sigma^{(0)} \subseteq T(\Sigma, V)$ and $V \subseteq T(\Sigma, V)$. 
    \item If $f \in \Sigma^{(n)}$, and $M_i \in T(\Sigma, V)$ for each $i \in [m], m \leq n$, then $f ~ M_1 ~ \cdots ~ M_m \in T(\Sigma, V)$. 
\end{enumerate}

The recursive structure of $T(\Sigma, V)$ prompts us to think of terms in a TRS as \emph{syntax trees}. We define $Pos(M) \subseteq \mathbb{N}^*$ for each $M \in T(\Sigma, V)$ to be the set of positions in $M$'s syntax tree. The root of the tree has position $\varepsilon$, and the $i$th child of a node at position $p$ has position $pi$. $M|_p$ is the subterm of $M$ rooted at position $p$, and $M[N]_p$ denotes $M$ with its term at position $p$ replaced by $N \in T(\Sigma, V)$. Additionally, we define $Var(M) \subseteq V$ to be the set of variables appearing in a term. $M$ is \emph{closed} iff $Var(M) = \emptyset$. 

A \emph{(one-hole) context} $C[\cdot] : T(\Sigma, V) \rightarrow T(\Sigma, V)$ is a term with a hole $\square$ at some position. $C[M]$ denotes the context $C[\cdot]$ with its hole replaced by the term $M$. 

A \emph{substitution} $\theta : X \rightarrow T(\Sigma, V)$ is a function mapping variables to terms, for which the set $\text{dom}(\theta) := \{ x \in V ~|~ \theta(x) \neq x\}$ is finite. Hence, we may write $\theta = [x_1 \mapsto M_1, x_2 \mapsto M_2, \cdots]$ for finitely many $x_i \in V$ and $M_i \in T(\Sigma,V)$. $M \theta$ denotes the term $M$ with each variable replaced by its $\theta$-image, and we call $M\theta$ an \emph{instance} of $M$. For two substitutions $\theta, \sigma$, we say that $\sigma$ is \emph{less general} than $\theta$ (and write $\sigma \leq \theta$) iff there exists some other substitution $\theta'$ such that $\sigma = \theta' \circ \theta$.
\\~\\
A reduction system $(X, \rightarrow)$ consists of a set $X$ equipped with a binary relation $\rightarrow ~\subseteq X \times X$. A reduction is \emph{terminating} iff there exist no infinite sequences $x_1x_2 \cdots \in X^\omega$ with $x_1 \rightarrow x_2 \rightarrow \cdots$. $x \in X$ is a \emph{redux} of $\rightarrow$ iff $x \rightarrow y$ for some $y \in X$. If $x$ is not a redux, we say that it is in \emph{$\rightarrow$-normal form}. A reduction system over $T(\Sigma, V)$ is a \emph{term rewrite system (TRS)} iff it is closed under contexts and substitutions (i.e. if $M \rightarrow N$, then $C[M\theta] \rightarrow C[N\theta]$ for all contexts $C[\cdot]$ and substitutions $\theta$). 

Here, we will consider TRSs defined by a set of equations $R \subseteq T(\Sigma, V) \times T(\Sigma, V)$. Note that our equations are presumed to be \emph{oriented}, meaning that $M \approx N \in R$ does not imply that $N \approx M \in R$. We also assume that $Var(M) \supseteq Var(N)$ for each $M \approx N \in R$. We define $\rightarrow_R$ such that, for each $M \approx N \in R$, and for all contexts $C[\cdot]$ and substitutions $\theta$, $C[M\theta] \rightarrow_R C[N\theta]$. 

An equation $M \approx N$ is \emph{stable} iff $M$ is headed by a defined function symbol. A TRS is stable iff all of its equations are stable. A TRS is a \emph{functional program} iff it is stable, and for each rule $f(x_1, \cdots, x_n) \approx N$, each $x_i$ contains no defined function symbols. We say that an equation $M \approx N$ is \emph{$Q$-normal} (where $Q$ is some TRS) iff $N$ is in $Q$-normal form. A TRS is $Q$-normal iff all of its rules are $Q$-normal. 


A TRS $\rightarrow$ also defines \emph{innermost} and \emph{outermostreduction systems} $\overset{i}{\rightarrow}$ and $\overset{o}{\rightarrow}$. Consider some term $M$ that is a redux of $\rightarrow$. In an innermost reduction sequence, we ...
\\~\\
A strict \emph{reduction order} $\succ ~ \subseteq T(\Sigma, V)^2$ is an order on terms that is closed under substitutions.  $\succsim$ is defined to be the reflexive closure of $\succ$. A reduction order is also \emph{monotonic} iff it is closed under contexts. $\succ$ is \emph{well-founded} iff every set $K \subseteq T(\Sigma, V)$ has a minimum under $\succ$ (i.e. $\forall K \subseteq T(\Sigma, V), \exists x \in K, \forall y \in K, x \precsim y$).

One particular ordering that will be of use is the subterm ordering $\subterm$, which is defined as follows: $M \subterm N$ iff $N|_p = M$ for some $p \in Pos(N)$.

\section{Flat Termination}

We introduce a definition of program termination inspired by the dependency pair framework which we prove to be a generalisation of \emph{size-change termination} \cite{lee2001sizechange,thiemann2005sizechange}.

\begin{definition}[Flat termination]
    Consider some term $x \in T(\Sigma_{def} \cup \Sigma_{con}, V)$, and assume the existence of an infinite list of free variables $V^\flat$. We define $x$'s \emph{flattening} $x^\flat$ as follows:
    \begin{itemize}
        \item If $x \in \Sigma_{con}$, then $x^\flat := x$.
        \item If $x = f ~ x_1 ~ \cdots ~ x_n$ for some $f \in \Sigma_{con}$, then $x^\flat := f ~ x^\flat_1 ~ \cdots ~ x_n$ 
        \item If $x = f ~ x_1 ~ \cdots ~ x_n$ for some $f \in \Sigma_{def}$, or if $x \in V$, then $x^\flat := v^\flat$, where $v^\flat$ is the next unused variable in $V^\flat$. 
    \end{itemize}
    Now consider some TRS $P \in T(\Sigma_{def} \cup \Sigma_{con}, V)^2$. We define its \emph{flattening} $P^\flat$ as follows:
    \begin{equation*}
        P^\flat := \{ f ~ s_1 ~ \cdots ~ s_n \approx g ~ t_1^\flat ~ \cdots ~ t_n^\flat ~|~ f ~ s_1 ~ \cdots ~ s_n \approx C[g ~ t_1 ~ \cdots ~ t_n] \in P \}
    \end{equation*}
    %$P$ is said to be \emph{flat terminating} iff $P^\flat$ is terminating.
\end{definition}

\begin{lemma}
    For any functional program $P$, if $P^\flat$ is terminating, then $P$ is terminating.
\end{lemma}
\begin{proof}
    Consider some infinite reduction sequence $t_1 \rightarrow_P t_2 \rightarrow_P \cdots$. Each term in this sequence must be some instance of the LHS of a rule in $P$. Hence, our sequence is of the form $C[f_1 ~ a_1] \rightarrow_P C[f_2 ~ a_2] \rightarrow_P \cdots$. 
\end{proof}

\begin{definition}[Size-change termination \cite{lee2001sizechange,thiemann2005sizechange}]
    Consider some functional program $P \subseteq T(\Sigma_{con} \cup \Sigma_{def}, V)^2$. For each rule $f ~ s_1 ~ \cdots ~ s_n \approx N$, and for each function symbol $g$ such that $N = C[g ~ t_1 ~ \cdots ~ t_m)]$ for some context $C$, we define a directed bipartite \emph{size-change graph} $G_f^g := (L, R, E)$ with respect to some ordering on constructor terms $\succ ~ \subseteq T(\Sigma_{con}, V)^2$.

    $G_f^g$ contains a vertex for each argument of $f$ and $g$ (i.e. $L = \{1_f, \cdots, n_f\}$ and $R = \{1_g, \cdots, m_g\}$). Each of $G_f^g$'s directed edges $e \in L \times R \times \{\succ, \succsim\}$ is labelled either with $\succ$ or $\succsim$. For each pair of arguments $s_i$ and $t_j$, if $s_i \succ t_j$, we have $(i_f, j_g, \succ) \in E$. Otherwise, if $s_i \succsim t_j$, we have $(i_f, j_g, \succsim) \in E$.

    We define the concatenation of two size-change graphs $G_f^g \circ G_g^h$ to be the graph obtained by unifying all of $G_f^g$'s input vertices with all of $G_g^h$'s output vertices.

   $P$ is defined to be \emph{size-change terminating} iff some infinite path of every concatenation of an infinite sequence of size-change graphs contains infinitely many edges labelled $\succ$.
\end{definition}
Observe that, like flat termination, this formalism of size-change termination is also stronger than termination. If a program is size-change terminating, then any possible infinite reduction sequence infinitely decrements some closed constructor term with respect to $\succ$, which violates $\succ$'s well-foundedness.

Also observe that this formalism ensures that any two functional programs $P$ and $P^\flat$ must have the same set of size-change graphs. Hence, $P$ is size-change terminating iff $P^\flat$ is also size-change terminating.



% \begin{lemma} \label{thm:size_change_max_multi}
%     A program $P$ is size-change terminating iff any maximal multigraph contains an edge labelled $\succ$.
% \end{lemma}

\begin{theorem}
    Consider some functional program $P$. If $P$ is size-change terminating with respect to $\succ$, $P^\flat$ is also size-change terminating with respect to $\succ$.
\end{theorem}
\begin{proof}
    Assume that $P$ is size-change terminating. Then in any call sequence of the form $G := (G_1^2 \circ G_2^3 \circ \cdots \circ G_{l-1}^1)^*$ contains an edge labelled $\succ$. Observe that this call sequences corresponds to some sequence of rules in $P^\flat$.  
\end{proof}




\renewcommand\em{\it}
\printbibliography[title={References}]

\end{document}